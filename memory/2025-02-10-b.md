# 2025-02-10 Session B — Portal Fixes + Test Env Deploy

## Portal Fixes (lockn-web + lockn-ai-platform)
- **lockn-web**: Added navbar with 3 CTAs (Launch Dashboard, Join Waitlist, Start Public Trial behind `NEXT_PUBLIC_ENABLE_PUBLIC_TRIAL` feature flag). Commit `d9c6104`.
- **lockn-ai-platform**: Removed "Open Ship" + duplicate "Join Waitlist" from navbar, renamed "Auth" → "LockN Auth" on dashboard. Commit `8952161`.
- **lockn-ai-platform**: Removed Auth0 gate from Ship page and Waitlist page — both are now public. Commit `8dc8443`.
- Next.js typed routes: use `as any` cast for routes that don't exist yet (e.g., `/app`, `/trial`)

## Test Environment Issues
- **Score containers missing**: `score-web-test` and `score-api-test` were never deployed to test env. Started `score-web-test` (instant, image cached). API building (~5min for PyTorch).
- **Auth0 `access_denied` on test.lockn.ai/score**: `VITE_AUTH0_AUDIENCE=https://api.lockn.ai` — that API identifier doesn't exist in Auth0. Test compose already has `VITE_DEMO_MODE_BYPASS_AUTH: "true"` so it bypasses auth.
- **Waitlist stuck "Checking your access..."**: Auth0 SPA SDK force-redirected unauthenticated users to login. Fixed by showing waitlist state directly for unauthed users.
- **Ship white screen**: `auth-guard.js` + `locknAuthGuard()` blocked page render until Auth0 completed. Removed gate — Ship is public.
- **Auth0 Allowed Origins**: `test.lockn.ai` likely not in Auth0 app's Allowed Callback URLs / Web Origins — needed for any Auth0 flows on test domain.

## Linear
- Created **LOC-447**: [Ops] Implement Git-Linear Sync — Auto-resolve merged branches + enforce Definition of Done
  - Definition of Done: In Progress → Resolved (merged, ready for QA) → Done (QA'd in Test env + test cases added)
  - Never auto-Done. Only human/QA marks Done.
  - GitHub Actions workflow to auto-move to Resolved on PR merge

## Score Architecture Gaps for Demo
- **No role selection**: QR scan lands on Home page with just "New Game". No camera-vs-player fork.
- **No audio-only miss detection**: Fusion tracker has 2.5s silence timeout, but audio-only path needs its own timeout for auto-miss.
- **Rally tracking works**: `handle_hit()` increments streak, `_update_high_score()` tracks max, `handle_miss()` resets to 0, saves to `rally_history` (last 10).
- **Demo workaround**: iPad → `/score/create` → spectator dashboard, Phone → mic stream to WS

## Infrastructure
- Test env: Cloudflare Tunnel → `localhost:8082` → Caddy test → containers on `lockn-test-net`
- Score API test container: `lockn-score-api-test` on port 3109 (internal 8000)
- Score Web test container: `lockn-score-web-test` on port 3109 (internal 8080)
- API build session `tide-lobster` — exporting 4GB+ image (PyTorch + CUDA + ML deps)

## Active Builds
- `tide-lobster`: Score API test image — pip install done, exporting layers (slow, 4GB+)
- Once done: `docker compose -f docker-compose.test.yml up -d score-api-test` to start it
